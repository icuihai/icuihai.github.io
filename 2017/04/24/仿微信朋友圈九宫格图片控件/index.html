<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="仿微信朋友圈九宫格图片控件
相信朋友们们对九宫格图片在熟悉不过了，由于项目中用到了，抽出了一点时间整理了以下，以此来记录学习的过程~~~
如何使用如何使用（只需要两步，炒鸡简单~~~）
1. 写一个类继承NIneImgView，实现三个抽象方法；
displayOneImage： 顾名思义只有一张图">
    

    <!--Author-->
    
        <meta name="author" content="icuihai">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="仿微信朋友圈九宫格图片控件"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Ich&#39;s Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>仿微信朋友圈九宫格图片控件 - Ich&#39;s Blog</title>

    <!-- Tachyons Core CSS -->
    <link rel="stylesheet" href="//unpkg.com/tachyons/css/tachyons.min.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<!-- Main Content -->
<!-- Banner -->
<!-- Banner -->
<div class="w-100 bg-1 ph5-ns ph3 text-light">
    
    <nav class="db dt-l w-100 mw8 center border-box pv3">
        <a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="Ich's Blog">
            <img src="http://p6nix480q.bkt.clouddn.com/18-7-6/36041900.jpg" class="dib h3" alt="Ich's Blog">
        </a>
        <div class="db dtc-l v-mid w-100 w-75-l tc tr-l">
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/" 
                    title="Home">
                    Home
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/archives" 
                    title="Archives">
                    Archives
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/tags" 
                    title="Tags">
                    Tags
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/categories" 
                    title="Categories">
                    Categories
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/about.html" 
                    title="About">
                    About
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/contact.html" 
                    title="Contact">
                    Contact
                </a>
            
        </div>
    </nav>

    <!-- Title -->
    <div class="w-100 mw8 center vh-40 dt">
        <div class="dtc v-mid white">
            <h1 class="f1-l f2-m tc tc-m tl-ns">仿微信朋友圈九宫格图片控件</h1>
            <p class="f4 fw3 pab-100px tc tc-m tl-ns">2017-04-24</p>
        </div>
    </div>

    <!-- Icon -->
    <div class="relative w-100 mw8 center white dn dn-m db-ns">
        <i class="header-icon fa fa-file-text-o"></i>
    </div>
</div>

<!-- Content -->
<div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l">
    <div class="content">
        <div class="mw8 center">
            <div class="cf">
                <div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content">
                    <!-- Tags Vertical -->
                    
                        <div class="tags-container-vertical">
                            <div class="tags-sub-container">
                                <a class="fw3 ph1 dib" href="/tags/Android/">#Android</a> <a class="fw3 ph1 dib" href="/tags/自定义View/">#自定义View</a>
                            </div>
                        </div>
                    

                    <!-- Main Post Content -->
                    <h3 id="仿微信朋友圈九宫格图片控件"><a href="#仿微信朋友圈九宫格图片控件" class="headerlink" title="仿微信朋友圈九宫格图片控件"></a>仿微信朋友圈九宫格图片控件</h3><blockquote>
<p>相信朋友们们对九宫格图片在熟悉不过了，由于项目中用到了，抽出了一点时间整理了以下，以此来记录学习的过程~~~</p>
<h4 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h4><p>如何使用（只需要两步，炒鸡简单~~~）</p>
<h5 id="1-写一个类继承NIneImgView，实现三个抽象方法；"><a href="#1-写一个类继承NIneImgView，实现三个抽象方法；" class="headerlink" title="1. 写一个类继承NIneImgView，实现三个抽象方法；"></a>1. 写一个类继承NIneImgView，实现三个抽象方法；</h5><ul>
<li><p>displayOneImage： 顾名思义只有一张图片调用该方法加载图片(当然可以随便使用你最喜欢的图片加载方式，比如Glide,PIcasso等)，</p>
</li>
<li><p>displayImage： 不是一张图片时调用该方法加载图片</p>
</li>
<li><p>onClickImage： 图片点击监听</p>
<h5 id="2-在XML控件中全路径写该控件，比如我写的时ExampleImgView"><a href="#2-在XML控件中全路径写该控件，比如我写的时ExampleImgView" class="headerlink" title="2.在XML控件中全路径写该控件，比如我写的时ExampleImgView"></a>2.在XML控件中全路径写该控件，比如我写的时ExampleImgView</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;   <span class="tag">&lt;<span class="name">com.cuihai.nineimgview.ExampleImgView</span></span></span><br><span class="line"><span class="tag">&gt;</span>   android:id="@+id/img"</span><br><span class="line">&gt;   android:layout_width="match_parent"</span><br><span class="line">&gt;   android:layout_height="wrap_content" /&gt;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<h4 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h4><ul>
<li>NineImgView<br>主要就是这个NineImgView这个类，先上代码（可能有点长~~）</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">NineImgView</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFUALT_SPACING = <span class="number">3f</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_COUNT = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Context mContext;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mSpacing = DEFUALT_SPACING;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mColumns;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mRows;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTotalWidth;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mSingleWidth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsShowAll = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsFirst = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; mUrlList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NineImgView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NineImgView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.NineImgViewLayout);</span><br><span class="line"></span><br><span class="line">        mSpacing = typedArray.getDimension(R.styleable.NineImgViewLayout_sapcing, DEFUALT_SPACING);</span><br><span class="line">        typedArray.recycle();</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">        <span class="comment">// 数据为0时，即没有图片的时不心显示。</span></span><br><span class="line">        <span class="keyword">if</span> (getListSize(mUrlList) == <span class="number">0</span>) &#123;</span><br><span class="line">            setVisibility(GONE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 整个控件的宽度</span></span><br><span class="line">        mTotalWidth = right - left;</span><br><span class="line">        mSingleWidth = (<span class="keyword">int</span>) ((mTotalWidth - mSpacing * (<span class="number">3</span> - <span class="number">1</span>)) / <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">if</span> (mIsFirst) &#123;</span><br><span class="line">            notifyDataSetChanged();</span><br><span class="line">            mIsFirst = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置间隔</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spacing</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSpacing</span><span class="params">(<span class="keyword">float</span> spacing)</span> </span>&#123;</span><br><span class="line">        mSpacing = spacing;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置是否显示所有图片（超过最大数时）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isShowAll</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIsShowAll</span><span class="params">(<span class="keyword">boolean</span> isShowAll)</span> </span>&#123;</span><br><span class="line">        mIsShowAll = isShowAll;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUrlList</span><span class="params">(List&lt;String&gt; urlList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (getListSize(urlList) == <span class="number">0</span>) &#123;</span><br><span class="line">            setVisibility(GONE);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        setVisibility(VISIBLE);</span><br><span class="line"></span><br><span class="line">        mUrlList.clear();</span><br><span class="line">        mUrlList.addAll(urlList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!mIsFirst) &#123;</span><br><span class="line">            notifyDataSetChanged();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyDataSetChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        post(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                refresh();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        removeAllViews();</span><br><span class="line">        <span class="keyword">int</span> size = getListSize(mUrlList);</span><br><span class="line">        <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            setVisibility(VISIBLE);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setVisibility(GONE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">1</span>) &#123;</span><br><span class="line">            String url = mUrlList.get(<span class="number">0</span>);</span><br><span class="line">            ImageView imageView = createImageView(<span class="number">0</span>, url);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//避免在ListView中一张图未加载成功时，布局高度受其他item影响</span></span><br><span class="line">            LayoutParams params = getLayoutParams();</span><br><span class="line">            params.height = mSingleWidth;</span><br><span class="line">            setLayoutParams(params);</span><br><span class="line">            imageView.layout(<span class="number">0</span>, <span class="number">0</span>, mSingleWidth, mSingleWidth);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">boolean</span> isShowDefualt = displayOneImage(imageView, url, mTotalWidth);</span><br><span class="line">            <span class="keyword">if</span> (isShowDefualt) &#123;</span><br><span class="line">                layoutImageView(imageView, <span class="number">0</span>, url, <span class="keyword">false</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                addView(imageView);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        generateChildrenLayout(size);</span><br><span class="line">        layoutParams();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            String url = mUrlList.get(i);</span><br><span class="line">            ImageView imageView;</span><br><span class="line">            <span class="keyword">if</span> (!mIsShowAll) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i &lt; MAX_COUNT - <span class="number">1</span>) &#123;</span><br><span class="line">                    imageView = createImageView(i, url);</span><br><span class="line">                    layoutImageView(imageView, i, url, <span class="keyword">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">//第9张时</span></span><br><span class="line">                    <span class="keyword">if</span> (size &lt;= MAX_COUNT) &#123;<span class="comment">//刚好第9张</span></span><br><span class="line">                        imageView = createImageView(i, url);</span><br><span class="line">                        layoutImageView(imageView, i, url, <span class="keyword">false</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;<span class="comment">//超过9张</span></span><br><span class="line">                        imageView = createImageView(i, url);</span><br><span class="line">                        layoutImageView(imageView, i, url, <span class="keyword">true</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                imageView = createImageView(i, url);</span><br><span class="line">                layoutImageView(imageView, i, url, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">layoutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> singleHeight = mSingleWidth;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据子view数量确定高度</span></span><br><span class="line">        LayoutParams params = getLayoutParams();</span><br><span class="line">        params.height = (<span class="keyword">int</span>) (singleHeight * mRows + mSpacing * (mRows - <span class="number">1</span>));</span><br><span class="line">        setLayoutParams(params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ImageView <span class="title">createImageView</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> i, <span class="keyword">final</span> String url)</span> </span>&#123;</span><br><span class="line">        ImageView imageView = <span class="keyword">new</span> ImageView(mContext);</span><br><span class="line">        imageView.setScaleType(ImageView.ScaleType.CENTER_CROP);</span><br><span class="line">        imageView.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                onClickImage(i, url, mUrlList);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> imageView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imageView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> showNumFlag 是否在最大值的图片上显示还有未显示的图片张数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">layoutImageView</span><span class="params">(ImageView imageView, <span class="keyword">int</span> i, String url, <span class="keyword">boolean</span> showNumFlag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> singleWidth = (<span class="keyword">int</span>) ((mTotalWidth - mSpacing * (<span class="number">3</span> - <span class="number">1</span>)) / <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">int</span> singleHeight = singleWidth;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] position = findPosition(i);</span><br><span class="line">        <span class="keyword">int</span> left = (<span class="keyword">int</span>) ((singleWidth + mSpacing) * position[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">int</span> top = (<span class="keyword">int</span>) ((singleHeight + mSpacing) * position[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">int</span> right = left + singleWidth;</span><br><span class="line">        <span class="keyword">int</span> bottom = top + singleHeight;</span><br><span class="line"></span><br><span class="line">        imageView.layout(left, top, right, bottom);</span><br><span class="line"></span><br><span class="line">        addView(imageView);</span><br><span class="line">        <span class="keyword">if</span> (showNumFlag) &#123;<span class="comment">//添加超过最大显示数量的文本</span></span><br><span class="line">            <span class="keyword">int</span> overCount = getListSize(mUrlList) - MAX_COUNT;</span><br><span class="line">            <span class="keyword">if</span> (overCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">float</span> textSize = <span class="number">30</span>;</span><br><span class="line">                <span class="keyword">final</span> TextView textView = <span class="keyword">new</span> TextView(mContext);</span><br><span class="line">                textView.setText(<span class="string">"+"</span> + String.valueOf(overCount));</span><br><span class="line">                textView.setTextColor(Color.WHITE);</span><br><span class="line">                textView.setPadding(<span class="number">0</span>, singleHeight / <span class="number">2</span> - getFontHeight(textSize), <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                textView.setTextSize(textSize);</span><br><span class="line">                textView.setGravity(Gravity.CENTER);</span><br><span class="line">                textView.setBackgroundColor(Color.BLACK);</span><br><span class="line">                textView.getBackground().setAlpha(<span class="number">120</span>);</span><br><span class="line"></span><br><span class="line">                textView.layout(left, top, right, bottom);</span><br><span class="line">                addView(textView);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        displayImage(imageView, url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] findPosition(<span class="keyword">int</span> childNum) &#123;</span><br><span class="line">        <span class="keyword">int</span>[] position = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mRows; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mColumns; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((i * mColumns + j) == childNum) &#123;</span><br><span class="line">                    position[<span class="number">0</span>] = i;<span class="comment">//行</span></span><br><span class="line">                    position[<span class="number">1</span>] = j;<span class="comment">//列</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据图片个数确定行列数量</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">generateChildrenLayout</span><span class="params">(<span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (length &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">            mRows = <span class="number">1</span>;</span><br><span class="line">            mColumns = length;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (length &lt;= <span class="number">6</span>) &#123;</span><br><span class="line">            mRows = <span class="number">2</span>;</span><br><span class="line">            mColumns = <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">if</span> (length == <span class="number">4</span>) &#123;</span><br><span class="line">                mColumns = <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mColumns = <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">if</span> (mIsShowAll) &#123;</span><br><span class="line">                mRows = length / <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">int</span> b = length % <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">if</span> (b &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    mRows++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                mRows = <span class="number">3</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setOneImageLayoutParams</span><span class="params">(ImageView imageView, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        imageView.setLayoutParams(<span class="keyword">new</span> LayoutParams(width, height));</span><br><span class="line">        imageView.layout(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line"></span><br><span class="line">        LayoutParams params = getLayoutParams();</span><br><span class="line"><span class="comment">//        params.width = width;</span></span><br><span class="line">        params.height = height;</span><br><span class="line">        setLayoutParams(params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getListSize</span><span class="params">(List&lt;String&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list == <span class="keyword">null</span> || list.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getFontHeight</span><span class="params">(<span class="keyword">float</span> fontSize)</span> </span>&#123;</span><br><span class="line">        Paint paint = <span class="keyword">new</span> Paint();</span><br><span class="line">        paint.setTextSize(fontSize);</span><br><span class="line">        Paint.FontMetrics fm = paint.getFontMetrics();</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) Math.ceil(fm.descent - fm.ascent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imageView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parentWidth 父控件宽度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 代表按照九宫格默认大小显示，false 代表按照自定义宽高显示</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">displayOneImage</span><span class="params">(ImageView imageView, String url, <span class="keyword">int</span> parentWidth)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">displayImage</span><span class="params">(ImageView imageView, String url)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onClickImage</span><span class="params">(<span class="keyword">int</span> position, String url, List&lt;String&gt; urlList)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">![Demo](F:\blog\source\_posts\仿微信朋友圈九宫格图片控件/nine.png)</span><br></pre></td></tr></table></figure>
                    
                    <!-- Tags Bottom -->
                    
                        <div class="tags-container-bottom">
                            <i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/Android/">#Android</a> <a class="fw3 ph1 dib" href="/tags/自定义View/">#自定义View</a>
                        </div>
                    

                    <!-- Comments -->
                    



                </div>
                <div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50">
                    
                    <hr class="dn-l mw4 black-50 mt5" />
                    
                    <!-- Widget 1: About -->
                    <div class="mt5 mt0-l">
    <article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3">
        <div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width: 6rem;">
            <img src="http://p6nix480q.bkt.clouddn.com/18-9-15/68427294.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="icuihai">
        </div>
        <div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">
            
        </div>
    </article>
</div>

                    <hr class="dn-l mw4 black-50 mt5" />
                    
                    <!-- Widget 2: Categories -->
                    
                        <div class="mt5 tc tl-l">
    <h3>Categories</h3>
    
        <p>
            <a href="/categories/blog/">blog</a>
        </p>
    
</div>


                        <hr class="dn-l mw4 black-50 mt5" />
                    

                    <!-- Widget 3: Recent Posts -->
                    <div class="mt5 tc tl-l">
    <h3>Recent Posts</h3>
    
        <p>
            <a href="/2018/07/19/全网最清晰的ConstraintLayout教程/">全网最清晰的ConstraintLayout教程</a>
        </p>
    
        <p>
            <a href="/2018/06/27/Android7-1-1Toast崩溃解决方案/">Android7.1.1Toast崩溃解决方案</a>
        </p>
    
        <p>
            <a href="/2018/04/04/编译Android下可执行命令的FFmpeg/">编译Android下可执行命令的FFmpeg</a>
        </p>
    
        <p>
            <a href="/2018/03/30/交叉编译-Mac环境使用NDK编译FFmpeg/">交叉编译-Mac环境使用NDK编译FFmpeg</a>
        </p>
    
        <p>
            <a href="/2018/03/15/使用Hexo搭建免费Blog/">使用Hexo搭建免费Blog</a>
        </p>
    
</div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<div class="bg-1 ph2 ph5-ns pv5">
        <div class="mv8">
            <div class="center tc">
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://twitter.com/?lang=en" target="_blank">
                            <i class="fa fa-twitter"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://www.facebook.com/" target="_blank">
                            <i class="fa fa-facebook"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://dribbble.com/" target="_blank">
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://github.com/icuihai" target="_blank">
                            <i class="fa fa-github"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://plus.google.com/" target="_blank">
                            <i class="fa fa-google-plus"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://www.behance.net/" target="_blank">
                            <i class="fa fa-behance"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://500px.com/" target="_blank">
                            <i class="fa fa-500px"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="mailto:icuihai@gmail.com" target="_blank">
                            <i class="fa fa-envelope"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="/#" target="_blank">
                            <i class="fa fa-rss"></i>
                        </a>
                    </div>
                
            </div>
<div >
<font size="2" color="red">本站总访问量<span id="busuanzi_value_site_pv"></span>次
本站访客数<span id="busuanzi_value_site_uv"></span>人次!</font>

</div>
            <div class="f6 f5-ns center tc white pt5 fw3">
                @Untitled. All right reserved | Design & Hexo <a class="link dim white" href="http://www.icuihai.com/">Ich's Blog</a>
            </div>
        </div>
    </div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>


<!-- After Footer -->
<!-- Disqus Comments -->



</body>

</html>